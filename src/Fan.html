<!DOCTYPE html>
<html>
  <head>
    <title>Project Demo | CSE2006 Review 02</title>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="favicon/site.webmanifest" />
    <link rel="stylesheet" href="./public/css/tailwind.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
      rel="stylesheet"
    />
    <style>
         @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap');

         html {
           font-family: 'Poppins', sans-serif;
         }

         body {
           background: #ebe5e7;
         }
      canvas{
        width: 100% !important;
        height: 100% !important;
        display: block !important;
      }

         #container {
           position: relative;
           width: 100%;
           height: 100%;
         }
         #labels {
           position: absolute;
           left: 27%;
           margin: 8%;
           top: 2%;
         }

        #labels1 {
           position: absolute;
           right: 5%;
           margin: 4%;
           top: 10%;
         }
      @media screen and (max-width: 1200px) {
      	#labels {
      		right:2%;
      		margin:0%;
      	}
      	#labels1 {
      	  right:0%;
      	  left:2%;
      	  top: 50%;
      	}
      }
    </style>
  </head>

  <body class="bg-base-200">
    <div
      class="navbar mb-2 shadow-lg bg-base-200 text-base-content rounded-box"
    >
      <div class="px-2 mx-2 navbar-start">
        <span class="text-lg font-bold"> Review 02 </span>
      </div>
      <div class="hidden px-2 mx-2 navbar-center lg:flex">
        <div class="-mx-2 flex items-stretch">
          <div class="mx-2">
            <a href="/" class="btn btn-ghost btn-sm rounded-btn">
              <span>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  height="24px"
                  viewBox="0 0 24 24"
                  width="24px"
                  fill="#000000"
                >
                  <path d="M0 0h24v24H0V0z" fill="none" />
                  <path
                    d="M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3zm5 15h-2v-6H9v6H7v-7.81l5-4.5 5 4.5V18z"
                  />
                  <path d="M7 10.19V18h2v-6h6v6h2v-7.81l-5-4.5z" opacity=".3" />
                </svg>
              </span>
              Home
            </a>
          </div>
          <div class="mx-2">
            <a class="btn btn-ghost btn-sm rounded-btn btn-active">
              <span>
                <i class="fas fa-fan"></i>
              </span>
              &nbspTest 3 - Fan Testing & Voice Testing
            </a>
          </div>
          <div class="mx-2">
            <a class="btn btn-ghost btn-sm rounded-btn">
              <span>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  height="24px"
                  viewBox="0 0 24 24"
                  width="24px"
                  fill="#000000"
                >
                  <path d="M0 0h24v24H0V0z" fill="none" />
                  <circle cx="9" cy="8.5" opacity=".3" r="1.5" />
                  <path
                    d="M4.34 17h9.32c-.84-.58-2.87-1.25-4.66-1.25s-3.82.67-4.66 1.25z"
                    opacity=".3"
                  />
                  <path
                    d="M9 12c1.93 0 3.5-1.57 3.5-3.5S10.93 5 9 5 5.5 6.57 5.5 8.5 7.07 12 9 12zm0-5c.83 0 1.5.67 1.5 1.5S9.83 10 9 10s-1.5-.67-1.5-1.5S8.17 7 9 7zm0 6.75c-2.34 0-7 1.17-7 3.5V19h14v-1.75c0-2.33-4.66-3.5-7-3.5zM4.34 17c.84-.58 2.87-1.25 4.66-1.25s3.82.67 4.66 1.25H4.34zm11.7-3.19c1.16.84 1.96 1.96 1.96 3.44V19h4v-1.75c0-2.02-3.5-3.17-5.96-3.44zM15 12c1.93 0 3.5-1.57 3.5-3.5S16.93 5 15 5c-.54 0-1.04.13-1.5.35.63.89 1 1.98 1 3.15s-.37 2.26-1 3.15c.46.22.96.35 1.5.35z"
                  />
                </svg>
              </span>
              Team 21
            </a>
          </div>
        </div>
      </div>
      <div class="navbar-end">
        <button
          id="connection"
          type="button"
          class="
            mr-2
            bg-red-600
            text-white
            p-2
            rounded
            leading-none
            flex
            items-center
          "
        >
          ESP8266 Disconnected
        </button>
        <a
          href="https://github.com/siddhsuresh/ArduinoVoiceTempControlled"
          class="btn btn-square btn-ghost"
        >
          <img src="./public/img/GitHub-Mark-32px.png" class="rounded-lg" />
        </a>
      </div>
    </div>
    <div id="container">
      <div id="world"></div>
      <div id="labels" class="!text-center prose prose-lg">
        <div class="max-w-md">
          <h1 class="mb-5 text-5xl font-bold">Arduino & ESP8266</h1>
          <p class="mb-5">
            Testing the Connectivity of ESP8266 using the Arduino Framework
            Using SocketIO Websockets In ExpressJS and NodeJS BackEnd
          </p>
          <div class="divider"></div>
          <div class="p-6 card">
            <div class="form-control">
              <label class="cursor-pointer label">
                <span class="label-text">
                  <h6 class="mb-5 text-xl font-bold">Toggle the Switch</h6>
                </span>
                <input
                  id="switch"
                  type="checkbox"
                  class="toggle toggle-lg toggle-primary"
                />
              </label>
            </div>
          </div>
          <div class="p-6 card">
            <div class="form-control">
              <label class="cursor-pointer label">
                <span class="label-text">
                  <h6 class="mb-5 text-xl font-bold">Voice Commands</h6>
                </span>
                <a id="mic" href="#my-modal" class="btn btn-circle btn-ghost"
                  ><i class="fas fa-microphone text-2xl"></i
                ></a>
                <div id="my-modal" class="modal">
                  <div class="modal-box">
                    <p id="modal-info"></p>
                    <div class="modal-action">
                      <a href="#" class="btn btn-primary">Close</a>
                    </div>
                  </div>
                </div>
              </label>
            </div>
          </div>
        </div>
      </div>
      <div id="labels1" class="py-10 m-auto max-w-xs">
        <div id="card" class="card text-center shadow-2xl">
          <div class="card-body">
            <h2 classs="font-bold text-lg">Latest Reading At</h2>
            <h3 id="myDate" class="font-extrabold text-lg"></h3>
            <h1 class="m-3 text-primary font-extrabold text-2xl">
              Temperature
            </h1>
            <div class="m-3 text-5xl font-bold">
              <span class="text-secondary"
                ><i class="fas fa-temperature-low"></i
              ></span>
              &nbsp<span id="temperature">26</span> &deg
            </div>
            <h1 class="m-3 text-accent-focus font-extrabold text-2xl">
              Humidity
            </h1>
            <div class="m-3 text-5xl font-bold">
              <span class="text-secondary"><i class="fas fa-wind"></i></span>
              &nbsp<span id="humidity">65</span> %
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script>
    //Use the API endpoint to get the latest reading
    var isConnected = false;
    var url = "/api/getReading";
    var xhr = new XMLHttpRequest();
    xhr.open("GET", url, true);
    xhr.onload = function () {
      if (xhr.status === 200) {
        var response = JSON.parse(xhr.responseText);
        var temperature = response.temperature;
        var humidity = response.humidity;
        var date = response.date;
        //Update the DOM with the latest reading
        document.getElementById("myDate").innerText = date;
        document.getElementById("temperature").innerText = temperature;
        document.getElementById("humidity").innerText = humidity;
      }
    };
    xhr.send();
    setInterval(function () {
      if (isConnected == false) {
        $("#connection").text("ESP8266 Disconnected");
        $("#connection").removeClass("bg-green-600");
        $("#connection").addClass("bg-red-600");
      }
    }, 8050);
    setInterval(function () {
      isConnected = false;
    }, 7050);
  </script>
  <script
    src="https://cdn.socket.io/4.3.2/socket.io.min.js"
    integrity="sha384-KAZ4DtjNhLChOB/hxXuKqhMLYvx3b5MlT55xPEiNmREKRzeEm+RVPlTnAn0ajQNs"
    crossorigin="anonymous"
  ></script>
  <script>
    if (window.location.protocol == "https:") {
      var socket = io({
        withCredentials: true,
      });
    } else {
      var socket = io();
    }
    socket.on("Fan State", (msg) => {
      console.log("Fan State: " + msg);
      if (msg === true) {
        $("#switch").prop("checked", true);
        isBlowing = true;
      } else {
        $("#switch").prop("checked", false);
        isBlowing = false;
      }
    });
    socket.on("Sensor", (msg) => {
      console.log(
        "Sensor Readings " + msg["temperature"] + " " + msg["humidity"]
      );
      isConnected = true;
      $("#connection").text("ESP8266 Connected");
      $("#connection").removeClass("bg-red-600");
      $("#connection").addClass("bg-green-600");
      $("#temperature").text(msg["temperature"]);
      $("#humidity").text(msg["humidity"]);
      //Change the background color of the labels based on the readings
      if (msg["temperature"] > 30) {
        //Add css class to id card
        //Remove all other bg classes
        $("#card").removeClass("bg-green-300");
        $("#card").removeClass("bg-blue-300");
        $("#card").addClass("bg-red-300");
      } else if (msg["temperature"] > 24.5) {
        $("#card").removeClass("bg-red-300");
        $("#card").removeClass("bg-blue-300");
        $("#card").addClass("bg-green-300");
      } else {
        $("#card").removeClass("bg-red-300");
        $("#card").removeClass("bg-green-300");
        $("#card").addClass("bg-blue-300");
      }

      //Change the date and time in myDate and myTime with the current date and time
      var date = new Date();
      var dateString = date.toLocaleString("en-GB");
      console.log(dateString);
      document.getElementById("myDate").innerText = dateString;
    });
    $(function () {
      $("#switch").click(function () {
        socket.emit("Fan State", $("#switch").is(":checked"));
      });
    });
  </script>
  <script src="./public/js/voiceCommands.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="./public/js/threejsFan.js"></script>
</html>