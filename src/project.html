<!DOCTYPE html>
<html lang="en" data-theme="corporate">
<head>
  <meta charset="UTF-8">
  <title>Project Demo | CSE2006 Final Review</title>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css'><link rel="stylesheet" href="./public/css/style.css">
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/daisyui/1.16.2/full.css'>
  <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
      rel="stylesheet"
    />
</head>
<body>
<!-- partial:index.partial.html -->
<header>
  <div class="w-3/4 mx-auto text-gray-700 bg-white text-xl">
    <div
      x-data="{ open: false }"
      class="
        flex flex-col
        max-w-screen-xl
        px-4
        mx-auto
        md:items-center
        md:justify-between
        md:flex-row
        md:mx-auto
        md:px-6
        lg:px-8
      "
      @keydown.escape="open = false"
    >
      <div class="flex flex-row items-center justify-between p-4">
        <a
          href="https://github.com/siddhsuresh/ArduinoVoiceTempControlled"
          ><img
            src="./public/img/GitHub-Mark-32px.png"
            class="rounded-lg" alt="Github"        
            /></a>
        <p class="font-bold p-4">Final Review - Team 21</p>
        <button
          class="
            rounded-lg
            md:hidden
            focus:outline-none focus:shadow-outline
          "
          @click="open = !open"
        >
          <svg fill="currentColor" viewBox="0 0 20 20" class="w-6 h-6">
            <path
              x-show="!open"
              fill-rule="evenodd"
              d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM9 15a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z"
              clip-rule="evenodd"
            ></path>
            <path
              x-show="open"
              fill-rule="evenodd"
              d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </button>
      </div>
      <nav
        :class="{'flex': open, 'hidden': !open}"
        class="
          flex-col flex-grow
          hidden
          pb-4
          md:pb-0 md:flex md:justify-end md:flex-row
        "
      >
         <a id="connection"
          href="#"
          class="
            px-4
            py-2
            mt-2
            text-lg
            font-semibold
            bg-green-300
            rounded-lg
            md:mt-0 md:ml-4
          "
          href="#"
          >ESP8266 Connected</a
        >
        <a
          href="/"
          class="
          px-4
            py-2
            mt-2
            text-lg
            font-semibold
            bg-transparent
            rounded-lg
            md:mt-0 md:ml-4
            hover:bg-gray-700 hover:text-white
            focus:bg-gray-200
            focus:outline-none
            focus:text-black
            focus:shadow-outline
          "
          href="#"
          >Home</a
        >
        <a
          href="/slides"
          class="
            px-4
            py-2
            mt-2
            text-lg
            font-semibold
            bg-transparent
            rounded-lg
            md:mt-0 md:ml-4
            hover:bg-gray-700 hover:text-white
            focus:bg-gray-200
            focus:outline-none
            focus:text-black
            focus:shadow-outline
          "
          >Presentation</a
        >
        <a
          href="/project"
          class="
          px-4
          py-2
          mt-2
          text-lg
          font-semibold
          text-white
          rounded-lg
          md:mt-0
          hover:bg-gray-200 hover:text-black
          focus:text-black
          focus:bg-gray-200
          focus:outline-none
          focus:shadow-outline
          bg-gray-700
          "
          href="#"
          >Project</a
        >
      </nav>
    </div>
  </div>
</header>
<section id="cont" class="text-gray-600 body-font">
  <div class="container py-24 mx-auto">
    <div id="text" class="flex flex-wrap -m-4 justify-center"> 
      <div class="p-4 lg:w-3/4">
        <div class="bg-purple-200 bg-opacity-75 px-8 pt-16 pb-24 rounded-lg overflow-hidden text-center relative">
          <h2 class="tracking-widest text-s font-medium text-gray-400 mb-1">FINAL PROJECT DEMO</h2>
          <h1 class="sm:text-5xl font-bold text-xl font-medium text-gray-900 mb-3 p-5">Arduino & ESP8266</h1>
          <p class="leading-relaxed mb-3">
            <p class="mb-5 text-xl">
              Connectivity of ESP8266 using the Arduino Framework
              Using SocketIO Websockets In ExpressJS and NodeJS BackEnd
              <div class="text-lg font-semibold">1) Use The Toggle Switch To Control the Fan
              <br/>2) Use Voice Commands 
              <br />3) Use Either Manual or Automatic Speed Control</div>
            </p>
          </p>
        </div>
      </div>
      <div class="p-4">
        <div id="card" class="bg-blue-300 bg-opacity-75 px-8 pt-16 pb-24 rounded-lg overflow-hidden text-center relative">
          <h2 classs="font-bold text-lg">Latest Reading At</h2>
            <h3 id="myDate" class="font-extrabold text-lg">25-11-2021 21:31:55</h3>
            <h1 class="m-3 text-primary font-extrabold text-2xl">
              Temperature
            </h1>
            <div class="m-3 text-5xl font-bold">
              <span class="text-secondary"
                ><i class="fas fa-temperature-low"></i
              ></span>
              &nbsp<span id="temperature">26</span> &deg
            </div>
            <h1 class="m-3 text-accent-focus font-extrabold text-2xl">
              Humidity
            </h1>
            <div class="m-3 text-5xl font-bold">
              <span class="text-secondary"><i class="fas fa-wind"></i></span>
              &nbsp<span id="humidity">65</span> %
            </div>
        </div>
      </div>
      <div class="p-4 lg:w-3/4">
        <div class="bg-red-100 bg-opacity-75 px-8 pt-16 pb-24 rounded-lg overflow-hidden text-center relative">
          <h1 class="sm:text-4xl font-black text-xl font-medium text-gray-900 mb-3 p-5">Fan & Voice Control</h1>  
          <div id="world" class="md:w-3/4 sm:opacity-100 md:h-1/2 md:overflow-hidden md:ml-auto h-0 opacity-0"></div> 
          <div class="form-control w-1/3 mx-auto pb-2">
            <label class="cursor-pointer label">
              <span class="font-bold text-2xl">Fan State</span> 
              <input id="checkcross" type="checkbox" class="toggle lg:toggle-lg md:toggle-md sm:toggle-sm">
            </label>
          </div>
          <br/>
          <div class="form-control w-1/3 mx-auto pt-2">
            <label class="cursor-pointer label">
              <span class="font-bold text-2xl">Voice Commands</span> 
              <label for="my-modal-2" class="btn btn-ghost modal-button"><i class="fas fa-microphone text-3xl"></i
                ></label> 
              <input type="checkbox" id="my-modal-2" class="modal-toggle"> 
              <div class="modal">
                <div class="modal-box">
                  <p id="modal-info" class="text-lg p-4">Ready To Recived Voice Command</p> 
                  <p class="font-bold text-lg">Commands Available</p>
                  <p id="modal-commands" class="text-lg"></p>
                  <div class="modal-action">
                    <label for="my-modal-2" class="btn">Close</label>
                  </div>
                </div>
              </div>
            </label>
          </div>
        </div>
      </div>
      <div id="control" class="p-4 lg:w-1/2">
        <div class="bg-green-100 bg-opacity-75 px-8 pt-16 pb-24 rounded-lg overflow-hidden text-center relative">
          <h2 class="tracking-widest text-xs title-font font-medium text-gray-400 mb-1">AUTOMATIC SPEED CONTROL</h2>
          <h1 class="title-font sm:text-2xl text-xl font-medium text-gray-900 mb-3 p-5">Controlling the Speed Of the Fan Programically Using the Temperature and Humidity Values</h1>
          <div class="p-6 card bordered w-3/4 mx-auto">
            <div class="form-control">
              <label class="cursor-pointer label">
                <span class="font-bold text-2xl">Automatic Speed Control</span> 
                <input id="auto" type="checkbox" checked class="toggle toggle-primary lg:toggle-lg md:toggle-md sm:toggle-sm">
              </label>
            </div>
          </div>
          <h2 class="text-center font-bold p-5 text-xl"> Formula For Calculation Of Speed(%) From Temperature & Humidity Readings</h2>
          $$ Speed(\%) = \frac{({\color{red} Temperature}\ - 20)({\color{blue} Humidity}\ - 50)}{100} $$
          <div class="text-center font-semibold text-lg">Current Fan Speed in PWM: <span id="speed"></span></div>
        </div>
      </div>
      <div id="control1" class="p-4">
        <div class="h-full bg-gray-100 bg-opacity-75 px-8 pt-16 pb-24 rounded-lg overflow-hidden text-center relative">
          <h2 class="tracking-widest text-xs title-font font-medium text-gray-400 mb-1">MANUAL SPEED CONTROL</h2>
          <h1 class="title-font sm:text-2xl text-xl font-medium text-gray-900 mb-3 p-5">Control the Fan Speed in % Connected to ESP8266</h1>
          <p class="leading-relaxed mb-3">Click the Slider and Use the 
            <kbd class="kbd">▲</kbd> 
            <kbd class="kbd">▼</kbd> 
            <kbd class="kbd">◀︎</kbd> 
            <kbd class="kbd">▶︎</kbd> Buttons <br/>Click and Drag the Slider</p>
          <section class="transition-all duration-1000 ease-in-out">
            <input id="manual" type="range" class="c-rng" min="0" max="100" step="10" data-range="circular" data-modifier="c-rng--blue"/> 
          </section>
          <br />
          <button id="updateManual" role="button" aria-pressed="true" class="btn btn-ghost ">Update Fan Speed</button> 
        </div>
      </div>
    </div>
  </div>
</section>
<!-- partial -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js'></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/2.8.0/alpine.js"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script  src="./public/js/script.js"></script>
  <script src="https://cdn.socket.io/4.3.2/socket.io.min.js" integrity="sha384-KAZ4DtjNhLChOB/hxXuKqhMLYvx3b5MlT55xPEiNmREKRzeEm+RVPlTnAn0ajQNs" crossorigin="anonymous"
  ></script>
  <script>
    var isConnected = false;
    var url = "/api/getReading";
    var xhr = new XMLHttpRequest();
    xhr.open("GET", url, true);
    xhr.onload = function () {
      if (xhr.status === 200) {
        var response = JSON.parse(xhr.responseText);
        var temperature = response.temperature;
        var humidity = response.humidity;
        var date = response.date;
        //Update the DOM with the latest reading
        document.getElementById("myDate").innerText = date;
        document.getElementById("temperature").innerText = temperature;
        document.getElementById("humidity").innerText = humidity;
      }
    };
    xhr.send();
    setInterval(function () {
      if (isConnected == false) {
        $("#connection").text("ESP8266 Disconnected");
        $("#connection").removeClass("bg-green-600");
        $("#connection").addClass("bg-red-600");
      }
    }, 8050);
    setInterval(function () {
      isConnected = false;
    }, 7050);
    if (window.location.protocol == "https:") {
      var socket = io({
        withCredentials: true,
      });
    } else {
      var socket = io();
    }
    socket.on("Fan State", (msg) => {
      console.log("Fan State: " + msg);
      if (msg === true) {
        $("#checkcross").prop("checked", true);
        isBlowing = true;
      } else {
        $("#checkcross").prop("checked", false);
        isBlowing = false;
      }
    });
    socket.on("PWM", (msg) => {
      console.log("PWM: " + msg);
      $("#speed").text(msg);
    });
    socket.on("Sensor", (msg) => {
      console.log(
        "Sensor Readings " + msg["temperature"] + " " + msg["humidity"]
      );
      isConnected = true;
      $("#connection").text("ESP8266 Connected");
      $("#connection").removeClass("bg-red-300");
      $("#connection").addClass("bg-green-300");
      $("#temperature").text(msg["temperature"]);
      $("#humidity").text(msg["humidity"]);
      //Change the background color of the labels based on the readings
      if (msg["temperature"] > 30) {
        //Add css class to id card
        //Remove all other bg classes
        $("#card").removeClass("bg-green-300");
        $("#card").removeClass("bg-blue-300");
        $("#card").addClass("bg-red-300");
      } else if (msg["temperature"] > 24.5) {
        $("#card").removeClass("bg-red-300");
        $("#card").removeClass("bg-blue-300");
        $("#card").addClass("bg-green-300");
      } else {
        $("#card").removeClass("bg-red-300");
        $("#card").removeClass("bg-green-300");
        $("#card").addClass("bg-blue-300");
      }
      //Change the date and time in myDate and myTime with the current date and time
      var date = new Date();
      var dateString = date.toLocaleString("en-GB");
      console.log(dateString);
      document.getElementById("myDate").innerText = dateString;
    });
    $(function () {
      $("#checkcross").click(function () {
        console.log("Checkbox clicked");
        socket.emit("Fan State", $("#checkcross").is(":checked"));
      });
      $("#auto").click(function () {
        console.log("Auto clicked");
        socket.emit("Auto", $("#auto").is(":checked"));
      });
      $("#updateManual").click(function () {
        document.getElementById('auto').checked = false;
        socket.emit("Manual", rslider.getSpeed());
      });
    });
  </script>
</body>
</html>
